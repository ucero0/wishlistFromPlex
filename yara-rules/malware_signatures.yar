/*
    YARA Rules for Media File Malware Detection
    
    These rules detect common malware patterns that may be embedded
    in media files or disguised as media files.
    
    Add your own rules or download community rules from:
    https://github.com/Yara-Rules/rules
*/

rule Suspicious_Executable_In_Media {
    meta:
        description = "Detects executable content hidden in media files"
        author = "Security Scanner"
        severity = "high"
    
    strings:
        $mz_header = { 4D 5A }  // MZ header (PE executable)
        $elf_header = { 7F 45 4C 46 }  // ELF header (Linux executable)
        
    condition:
        ($mz_header at 0) or ($elf_header at 0)
}

rule Double_Extension_Media {
    meta:
        description = "Detects double extension trick (e.g., movie.mp4.exe)"
        author = "Security Scanner"
        severity = "medium"
    
    strings:
        $ext1 = ".mp4.exe" nocase
        $ext2 = ".mkv.exe" nocase
        $ext3 = ".avi.exe" nocase
        $ext4 = ".mov.exe" nocase
        $ext5 = ".mp4.scr" nocase
        $ext6 = ".mkv.scr" nocase
        
    condition:
        any of them
}

rule Embedded_JavaScript {
    meta:
        description = "Detects potentially malicious JavaScript in files"
        author = "Security Scanner"
        severity = "medium"
    
    strings:
        $js1 = "<script" nocase
        $js2 = "javascript:" nocase
        $js3 = "eval(" nocase
        $js4 = "document.write" nocase
        
    condition:
        2 of them
}

rule Suspicious_PowerShell {
    meta:
        description = "Detects PowerShell commands that may indicate malware"
        author = "Security Scanner"
        severity = "high"
    
    strings:
        $ps1 = "powershell" nocase
        $ps2 = "-encodedcommand" nocase
        $ps3 = "-exec bypass" nocase
        $ps4 = "invoke-expression" nocase
        $ps5 = "downloadstring" nocase
        
    condition:
        2 of them
}

rule Ransomware_Indicators {
    meta:
        description = "Detects common ransomware indicators"
        author = "Security Scanner"
        severity = "critical"
    
    strings:
        $ransom1 = "your files have been encrypted" nocase
        $ransom2 = "bitcoin" nocase
        $ransom3 = "decrypt" nocase
        $ransom4 = "pay the ransom" nocase
        $ransom5 = ".onion" nocase
        
    condition:
        3 of them
}

